import os

from flask import Flask, request, make_response, jsonify
from flask_cors import CORS
from flask_migrate import Migrate

import requests
from dotenv import load_dotenv

from elevenlabs import set_api_key, clone, generate, stream, play

from models import db

# xi isn't scary it just means eleven (XI) labs!
# XI_API_KEY is our API key from the XI Labs website
# VOICE_SAMPLE_PATH is the path to the voice sample you want to upload
# OUTPUT_PATH is the path to the output file

app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///app.db'
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False
app.json.compact = False

CORS(app)
migrate = Migrate(app, db)

db.init_app(app)


CHUNK_SIZE = 1024

ELEVENLABS_API_KEY = os.getenv("ELEVENLABS_API_KEY")
set_api_key(ELEVENLABS_API_KEY)
XI_API_KEY = ELEVENLABS_API_KEY

VOICE_SAMPLE_PATH1 = "<path-to-file>"
VOICE_SAMPLE_PATH2 = "<path-to-file>"
OUTPUT_PATH = "<path-to-file>"

# ADD VOICE SAMPLE
# MUST RECEIVE AUDIO FILE FROM FRONTEND TO A ROUTE WITH THIS:

@app.route('/add_voice', methods=['POST'])
def add_voice():
    if request.method == 'POST':
        
        # Get the file from the request

        url = "https://api.elevenlabs.io/v1/voices/add"

        headers = {
          "Accept": "application/json",
          "xi-api-key": "<xi-api-key>"
        }

        data = {
            'name': 'Voice name',
            'labels': '{"accent": "American"}',
            'description': 'Voice description'
        }

        files = [
            ('files', ('sample1.mp3', open('sample1.mp3', 'rb'), 'audio/mpeg')),
            ('files', ('sample2.mp3', open('sample2.mp3', 'rb'), 'audio/mpeg'))
        ]

        response = requests.post(url, headers=headers, data=data, files=files)
        
        print(response.text)



        return make_response(
            # jsonify([placeholder.to_dict() for placeholder in placeholders]),
            # 200,
        )
    
    return make_response(
        jsonify({"text": "Method Not Allowed"}),
        400,
    ) 


